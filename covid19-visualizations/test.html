<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="d3.js" type="text/javascript"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .axis path,
        .axis line{
            fill: none;
            stroke: black;
            shape-rendering: crispEdges;
        }
    </style>
</head>
<body>
<div class='box1'></div>
<script>
    var width = 950; //画布的宽
    var height = 400; //画布的长

    var svg = d3.select(".box1") //在指向位置初始化画布
        .append("svg")
        .attr("width", width)
        .attr("height", height);
    var padding = {left:55, right:30, top:20, bottom:20};
    var dataset = [408608, 414170, 415948, 414363, 410737, 399179, 391441, 347410, 347410, 344321, 324430, 323186, 315656, 311926, 308851, 309639, 320029, 319999];
    var index_year = ['2001', '2002', '2003', '2004', '2005', '2006', '2007', '2008', '2009', '2010', '2011', '2012', '2013', '2014', '2015', '2016', '2017', '2018'];

    // 构建x轴比例尺
    var xScale = d3.scale.ordinal()
        .domain(index_year)
        .range([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17])
        .rangeRoundBands([0, width - padding.left - padding.right]);

    // 定义x轴
    var xAxis = d3.svg.axis()
        .scale(xScale)
        .orient("bottom");

    var yScale = d3.scale.linear()
        .domain([150000,d3.max(dataset)])
        .range([height - padding.top - padding.bottom, 0]);
    var yAxis = d3.svg.axis()
        .scale(yScale)
        .orient("left");

    // 定义矩形之间的空白
    var rectPadding = 4;
    var max = d3.max(dataset);

    // 添加矩形元素
    var rects = svg.selectAll(".MyRect")
        .data(dataset)
        .enter()
        .append("rect")
        .attr("class","MyRect")
        .attr("transform","translate(" + padding.left + "," + padding.top + ")")
        .attr("x", function(d,i){
            return i*(xScale.rangeBand()) + rectPadding/2;
            // return xScale(i) + rectPadding/2;
        } )
        .attr("y",function(d){
            return yScale(d);
        })
        .attr("width", xScale.rangeBand() - rectPadding )
        .attr("height", function(d){
            return height - padding.top - padding.bottom - yScale(d);
        })
        .attr("fill", function(d){
            return "rgb(106, 139, " + d/max*200 + ")";// 根据值的大小获取颜色
        })
        .on("mouseover",function(d,i){
            d3.select(this)
                .attr("fill","grey");
        }) // 当鼠标滑过该矩形时，填充颜色变为灰色
        .on("mouseout",function(d,i){
            d3.select(this)
                .transition()
                .duration(500)
                .attr("fill",function(d){
                    return "rgb(106, 139, " + d/max*200 + ")";
                });
        }) // 当鼠标离开该矩形时，填充颜色恢复
    ;

    //添加x轴
    svg.append("g")
        .attr("class","axis axis--x")
        .attr("transform","translate(" + padding.left + "," + (height - padding.bottom) + ")")
        .call(xAxis);

    //添加y轴
    svg.append("g")
        .attr("class","axis axis--y")
        .attr("transform","translate(" + padding.left + "," + padding.top + ")")
        .call(yAxis);
</script>
</body>
</html>